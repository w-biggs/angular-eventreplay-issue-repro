<div class="container">
  <h1>Angular Event Replay — Double-Fire Repro</h1>

  <!-- Status indicators -->
  <div class="status-panel">
    <div class="status-item">
      <span class="status-label">Component:</span>
      <span class="status-value" [class.ready]="isHydrated()" [class.waiting]="!isHydrated()">
        {{ isHydrated() ? 'Hydrated' : 'Hydrating…' }}
      </span>
    </div>
    <div class="status-item">
      <span class="status-label">App stability:</span>
      <span class="status-value" [class.ready]="isStable()" [class.waiting]="!isStable()">
        {{ isStable() ? 'Stable' : 'Unstable — ' + countdown() + 's remaining' }}
      </span>
    </div>
  </div>

  <!-- Instructions -->
  <div class="instructions">
    Build and serve the SSR app (<code>npm run build &amp;&amp; npm run serve:ssr</code>), then load
    the page and click the button <strong>while the app is still unstable</strong> (within the first
    ~{{ STABILITY_DELAY_S }}s). Each physical click should register once. If it registers twice —
    with the second firing labelled <strong>REPLAY</strong> — the issue is present.
  </div>

  <!-- Click button -->
  <button (click)="onButtonClick()" class="click-btn">Click Me</button>

  <!-- Counter -->
  <div class="counter">
    <div class="counter-value" [class.bug-detected]="doubleFires() > 0">{{ totalClicks() }}</div>
    <div class="counter-label">total click events fired</div>
  </div>

  <!-- Bug banner -->
  @if (doubleFires() > 0) {
    <div class="bug-banner">
      {{ doubleFires() }} click(s) were double-fired due to event replay.
    </div>
  }

  <!-- Click log -->
  @if (clickLog().length > 0) {
    <div class="log-section">
      <h3>Event Log (newest first)</h3>
      <ul class="log-list">
        @for (entry of clickLog(); track entry.index) {
          <li class="log-entry" [class.replay]="entry.isReplay" [class.normal]="!entry.isReplay">
            <span class="log-index">#{{ entry.index }}</span>
            <span class="log-time">{{ entry.time }}</span>
            <span class="log-stable">app {{ entry.appWasStable ? 'stable' : 'unstable' }}</span>
            <span class="log-tag">{{ entry.isReplay ? 'REPLAY' : 'real' }}</span>
          </li>
        }
      </ul>
    </div>
  }
</div>
